<!DOCTYPE html>
    <html>
      <head>
          <title>Google Maps API</title>
          <script>
              var dataPoints = [{"timestamp":"1678526423","device_id":"4588053326789693194","latitude":43.5934289,"longitude":5.1770362},{"timestamp":"1678526421","device_id":"4588053326789693194","latitude":43.5933607,"longitude":5.1770339},{"timestamp":"1678525264","device_id":"4588053326789693194","latitude":43.4947162,"longitude":5.5251361},{"timestamp":"1678524133","device_id":"4588053326789693194","latitude":43.4739243,"longitude":5.6030699},{"timestamp":"1678523663","device_id":"4588053326789693194","latitude":43.4737604,"longitude":5.6030726},{"timestamp":"1678522823","device_id":"4588053326789693194","latitude":43.4946302,"longitude":5.5251991},{"timestamp":"1678522556","device_id":"4588053326789693194","latitude":43.5119,"longitude":5.4494524},{"timestamp":"1678521895","device_id":"4588053326789693194","latitude":43.5685451,"longitude":5.2207072},{"timestamp":"1678521632","device_id":"4588053326789693194","latitude":43.5914949,"longitude":5.1809008},{"timestamp":"1678521055","device_id":"4588053326789693194","latitude":43.5890581,"longitude":5.1881636},{"timestamp":"1678520529","device_id":"4588053326789693194","latitude":43.5935408,"longitude":5.1674804},{"timestamp":"1678519569","device_id":"4588053326789693194","latitude":43.7130285,"longitude":5.0932097},{"timestamp":"1678519058","device_id":"4588053326789693194","latitude":43.8358769,"longitude":5.0006318},{"timestamp":"1678517007","device_id":"4588053326789693194","latitude":44.325394,"longitude":4.7395977},{"timestamp":"1678516818","device_id":"4588053326789693194","latitude":44.3805836,"longitude":4.7341812},{"timestamp":"1678516768","device_id":"4588053326789693194","latitude":44.394007,"longitude":4.7298007},{"timestamp":"1678515970","device_id":"4588053326789693194","latitude":44.6060278,"longitude":4.7937049},{"timestamp":"1678515800","device_id":"4588053326789693194","latitude":44.6544036,"longitude":4.7950723},{"timestamp":"1678515617","device_id":"4588053326789693194","latitude":44.7056003,"longitude":4.7859913},{"timestamp":"1678515385","device_id":"4588053326789693194","latitude":44.7707587,"longitude":4.8018048},{"timestamp":"1678514344","device_id":"4588053326789693194","latitude":45.0343639,"longitude":4.8760384},{"timestamp":"1678513482","device_id":"4588053326789693194","latitude":45.2187543,"longitude":4.859151},{"timestamp":"1678512728","device_id":"4588053326789693194","latitude":45.2764802,"longitude":4.8256889},{"timestamp":"1678512189","device_id":"4588053326789693194","latitude":45.3303326,"longitude":4.8049377},{"timestamp":"1678510886","device_id":"4588053326789693194","latitude":45.5966848,"longitude":4.7960672},{"timestamp":"1678510376","device_id":"4588053326789693194","latitude":45.7147083,"longitude":4.8221709},{"timestamp":"1678510118","device_id":"4588053326789693194","latitude":45.7464393,"longitude":4.8289827},{"timestamp":"1678509677","device_id":"4588053326789693194","latitude":45.8108078,"longitude":4.7679228},{"timestamp":"1678509542","device_id":"4588053326789693194","latitude":45.8416773,"longitude":4.7516505},{"timestamp":"1678509153","device_id":"4588053326789693194","latitude":45.9393298,"longitude":4.7231832},{"timestamp":"1678508646","device_id":"4588053326789693194","latitude":46.0248049,"longitude":4.7330526},{"timestamp":"1678508608","device_id":"4588053326789693194","latitude":46.0385672,"longitude":4.7261497},{"timestamp":"1678508370","device_id":"4588053326789693194","latitude":46.1124267,"longitude":4.7611537},{"timestamp":"1678508215","device_id":"4588053326789693194","latitude":46.1474384,"longitude":4.7708757},{"timestamp":"1678506806","device_id":"4588053326789693194","latitude":46.5073146,"longitude":4.907829},{"timestamp":"1678506713","device_id":"4588053326789693194","latitude":46.5166494,"longitude":4.9208188},{"timestamp":"1678506266","device_id":"4588053326789693194","latitude":46.6189938,"longitude":4.8668673},{"timestamp":"1678506056","device_id":"4588053326789693194","latitude":46.6927604,"longitude":4.8429913},{"timestamp":"1678505968","device_id":"4588053326789693194","latitude":46.6932173,"longitude":4.8430959},{"timestamp":"1678505657","device_id":"4588053326789693194","latitude":46.6929846,"longitude":4.8431352},{"timestamp":"1678505238","device_id":"4588053326789693194","latitude":46.7909069,"longitude":4.8211394},{"timestamp":"1678504915","device_id":"4588053326789693194","latitude":46.8659115,"longitude":4.8202995},{"timestamp":"1678504538","device_id":"4588053326789693194","latitude":46.9645591,"longitude":4.8367648},{"timestamp":"1678503562","device_id":"4588053326789693194","latitude":47.2115139,"longitude":4.9997315},{"timestamp":"1678502575","device_id":"4588053326789693194","latitude":47.4117869,"longitude":5.1777624},{"timestamp":"1678502533","device_id":"4588053326789693194","latitude":47.4233045,"longitude":5.1721508},{"timestamp":"1678502294","device_id":"4588053326789693194","latitude":47.4880489,"longitude":5.1884547},{"timestamp":"1678501595","device_id":"4588053326789693194","latitude":47.6787328,"longitude":5.1775062},{"timestamp":"1678501168","device_id":"4588053326789693194","latitude":47.7778964,"longitude":5.2127928},{"timestamp":"1678498642","device_id":"4588053326789693194","latitude":48.2337931,"longitude":5.8521287},{"timestamp":"1678497771","device_id":"4588053326789693194","latitude":48.4728154,"longitude":5.8815058},{"timestamp":"1678496893","device_id":"4588053326789693194","latitude":48.688029,"longitude":5.9803116},{"timestamp":"1678496218","device_id":"4588053326789693194","latitude":48.7421743,"longitude":6.1528039},{"timestamp":"1678495215","device_id":"4588053326789693194","latitude":49.0070655,"longitude":6.1102247},{"timestamp":"1678494868","device_id":"4588053326789693194","latitude":49.0967879,"longitude":6.1189422},{"timestamp":"1678494293","device_id":"4588053326789693194","latitude":49.2318805,"longitude":6.1794671},{"timestamp":"1678492949","device_id":"4588053326789693194","latitude":49.5523162,"longitude":6.1282395},{"timestamp":"1678492917","device_id":"4588053326789693194","latitude":49.5545669,"longitude":6.1290563},{"timestamp":"1678492621","device_id":"4588053326789693194","latitude":49.6181861,"longitude":6.0832929},{"timestamp":"1678492143","device_id":"4588053326789693194","latitude":49.6467896,"longitude":5.9544765},{"timestamp":"1678491724","device_id":"4588053326789693194","latitude":49.6467894,"longitude":5.9544588},{"timestamp":"1678491556","device_id":"4588053326789693194","latitude":49.6456636,"longitude":5.9557604},{"timestamp":"1678491392","device_id":"4588053326789693194","latitude":49.6467858,"longitude":5.9544967},{"timestamp":"1678490429","device_id":"4588053326789693194","latitude":49.6954742,"longitude":5.6986401},{"timestamp":"1678486920","device_id":"4588053326789693194","latitude":50.4368567,"longitude":4.9374816},{"timestamp":"1678486085","device_id":"4588053326789693194","latitude":50.6365153,"longitude":4.7431174},{"timestamp":"1678484823","device_id":"4588053326789693194","latitude":50.8809375,"longitude":4.460648},{"timestamp":"1678484302","device_id":"4588053326789693194","latitude":51.0063586,"longitude":4.4600559},{"timestamp":"1678484113","device_id":"4588053326789693194","latitude":51.0437313,"longitude":4.4469735},{"timestamp":"1678483965","device_id":"4588053326789693194","latitude":51.0914263,"longitude":4.4398557},{"timestamp":"1678483578","device_id":"4588053326789693194","latitude":51.1919674,"longitude":4.4124357},{"timestamp":"1678483436","device_id":"4588053326789693194","latitude":51.2185541,"longitude":4.4500724},{"timestamp":"1678483233","device_id":"4588053326789693194","latitude":51.2443383,"longitude":4.4280795},{"timestamp":"1678483101","device_id":"4588053326789693194","latitude":51.268496,"longitude":4.4921663},{"timestamp":"1678482826","device_id":"4588053326789693194","latitude":51.3401136,"longitude":4.6146008},{"timestamp":"1678482726","device_id":"4588053326789693194","latitude":51.3416475,"longitude":4.6164148},{"timestamp":"1678482380","device_id":"4588053326789693194","latitude":51.4202992,"longitude":4.7071631},{"timestamp":"1678482175","device_id":"4588053326789693194","latitude":51.4743177,"longitude":4.7293594},{"timestamp":"1678481567","device_id":"4588053326789693194","latitude":51.6414547,"longitude":4.6949476},{"timestamp":"1678481283","device_id":"4588053326789693194","latitude":51.7225726,"longitude":4.6318338},{"timestamp":"1678481060","device_id":"4588053326789693194","latitude":51.7762526,"longitude":4.6496908},{"timestamp":"1678480886","device_id":"4588053326789693194","latitude":51.8161267,"longitude":4.6309918},{"timestamp":"1678480665","device_id":"4588053326789693194","latitude":51.8696855,"longitude":4.5781979},{"timestamp":"1678480473","device_id":"4588053326789693194","latitude":51.9151075,"longitude":4.5353033},{"timestamp":"1678480346","device_id":"4588053326789693194","latitude":51.9483536,"longitude":4.5296782},{"timestamp":"1678480294","device_id":"4588053326789693194","latitude":51.9425142,"longitude":4.4926844},{"timestamp":"1678480250","device_id":"4588053326789693194","latitude":51.9434426,"longitude":4.4914166},{"timestamp":"1678479989","device_id":"4588053326789693194","latitude":51.9432883,"longitude":4.4245948},{"timestamp":"1678479961","device_id":"4588053326789693194","latitude":51.9473259,"longitude":4.4198107},{"timestamp":"1678479817","device_id":"4588053326789693194","latitude":51.9824459,"longitude":4.3948275},{"timestamp":"1678479763","device_id":"4588053326789693194","latitude":51.9969909,"longitude":4.3886603},{"timestamp":"1678479310","device_id":"4588053326789693194","latitude":52.0933609,"longitude":4.430044},{"timestamp":"1678479276","device_id":"4588053326789693194","latitude":52.1236349,"longitude":4.4776695},{"timestamp":"1678479113","device_id":"4588053326789693194","latitude":52.1311354,"longitude":4.4949212},{"timestamp":"1678478614","device_id":"4588053326789693194","latitude":52.2216245,"longitude":4.6314318},{"timestamp":"1678478434","device_id":"4588053326789693194","latitude":52.2598948,"longitude":4.686122},{"timestamp":"1678478345","device_id":"4588053326789693194","latitude":52.2780571,"longitude":4.7117483},{"timestamp":"1678478229","device_id":"4588053326789693194","latitude":52.2923422,"longitude":4.717212},{"timestamp":"1678467225","device_id":"4588053326789693194","latitude":52.2911937,"longitude":4.7073124}];
              function initMap() {
                  var map = new google.maps.Map(document.getElementById('map'), {
                  center: {lat: dataPoints[0]['latitude'], lng: dataPoints[0]['longitude']},
                   zoom: 18
              });
              dataPoints.forEach((data, index) => {

                var date = new Date(data['timestamp'] * 1000);
                var formattedTime = date.toLocaleString('en-US', {timeZoneName: 'short'})
                var marker;
                
                if(index === 0) {
                  console.log('first')
                  marker = new google.maps.Marker({
                      position: { lat: data['latitude'], lng: data['longitude'] },
                      map: map,
                      title: formattedTime,
                      zIndex:99999999,
                      icon: {
                          url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
                      }
                  });
                } else {
                  marker = new google.maps.Marker({
                      position: { lat: data['latitude'], lng: data['longitude'] },
                      map: map,
                      title: formattedTime,
                      icon: {
                          url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                      }
                  });
                }
                var infowindow = new google.maps.InfoWindow();

                var geocoder = new google.maps.Geocoder;
                var myLatLng = {lat: data['latitude'], lng: data['longitude']};
                
                google.maps.event.addListener(marker, 'click', function() {
                  geocoder.geocode({'location': myLatLng}, function(results, status) {
                    if (status === 'OK') {
                      if (results[0]) {
                        infowindow.setContent(results[0].formatted_address + "<br>" + marker.title);
                        infowindow.open(map, marker);
                      } else {
                        window.alert('No results found');
                      }
                    } else {
                      window.alert('Geocoder failed due to: ' + status);
                    }
                });
              })
                
                google.maps.event.addListener(map, 'click', function() {
                  infowindow.close();
                });
              })
            }
          </script>
      </head>
      <body onload='initMap()'>
          <div id='map' style='height: 1200px; width: 100%;'></div>
          <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAFjmwW7a9Z_MnjMtn4lcGwJsJgiiUZ66k&callback=initMap'></script>
      </body>
    </html>