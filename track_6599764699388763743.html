<!DOCTYPE html>
    <html>
      <head>
          <title>Google Maps API</title>
          <script>
              var dataPoints = [{"timestamp":"1675883417","device_id":"6599764699388763743","latitude":50.0938424,"longitude":8.6358684},{"timestamp":"1675882238","device_id":"6599764699388763743","latitude":50.0936273,"longitude":8.6354692},{"timestamp":"1675880566","device_id":"6599764699388763743","latitude":50.0937511,"longitude":8.6353828},{"timestamp":"1675879816","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675879471","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675878631","device_id":"6599764699388763743","latitude":50.0938884,"longitude":8.6356413},{"timestamp":"1675878567","device_id":"6599764699388763743","latitude":50.0938884,"longitude":8.6356413},{"timestamp":"1675877569","device_id":"6599764699388763743","latitude":50.09405,"longitude":8.635829},{"timestamp":"1675876887","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675876774","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675876179","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675875548","device_id":"6599764699388763743","latitude":50.0938208,"longitude":8.6358056},{"timestamp":"1675875034","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675874571","device_id":"6599764699388763743","latitude":50.0938169,"longitude":8.6355939},{"timestamp":"1675873763","device_id":"6599764699388763743","latitude":50.0938873,"longitude":8.6362569},{"timestamp":"1675873639","device_id":"6599764699388763743","latitude":50.0937891,"longitude":8.6354764},{"timestamp":"1675873009","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675872761","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675872246","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675871255","device_id":"6599764699388763743","latitude":50.0938849,"longitude":8.6362767},{"timestamp":"1675870379","device_id":"6599764699388763743","latitude":50.0937511,"longitude":8.6353828},{"timestamp":"1675870351","device_id":"6599764699388763743","latitude":50.093506,"longitude":8.6366327},{"timestamp":"1675865058","device_id":"6599764699388763743","latitude":50.0941776,"longitude":8.6377162},{"timestamp":"1675862177","device_id":"6599764699388763743","latitude":50.0936616,"longitude":8.6353998}];
              function initMap() {
                  var map = new google.maps.Map(document.getElementById('map'), {
                  center: {lat: dataPoints[0]['latitude'], lng: dataPoints[0]['longitude']},
                   zoom: 18
              });
              dataPoints.forEach((data, index) => {

                var date = new Date(data['timestamp'] * 1000);
                var formattedTime = date.toLocaleString('en-US', {timeZoneName: 'short'})
                var marker;
                
                if(index === 0) {
                  console.log('first')
                  marker = new google.maps.Marker({
                      position: { lat: data['latitude'], lng: data['longitude'] },
                      map: map,
                      title: formattedTime,
                      zIndex:99999999,
                      icon: {
                          url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
                      }
                  });
                } else {
                  marker = new google.maps.Marker({
                      position: { lat: data['latitude'], lng: data['longitude'] },
                      map: map,
                      title: formattedTime,
                      icon: {
                          url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                      }
                  });
                }
                var infowindow = new google.maps.InfoWindow();

                var geocoder = new google.maps.Geocoder;
                var myLatLng = {lat: data['latitude'], lng: data['longitude']};
                
                google.maps.event.addListener(marker, 'click', function() {
                  geocoder.geocode({'location': myLatLng}, function(results, status) {
                    if (status === 'OK') {
                      if (results[0]) {
                        infowindow.setContent(results[0].formatted_address + "<br>" + marker.title);
                        infowindow.open(map, marker);
                      } else {
                        window.alert('No results found');
                      }
                    } else {
                      window.alert('Geocoder failed due to: ' + status);
                    }
                });
              })
                
                google.maps.event.addListener(map, 'click', function() {
                  infowindow.close();
                });
              })
            }
          </script>
      </head>
      <body onload='initMap()'>
          <div id='map' style='height: 1200px; width: 100%;'></div>
          <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAFjmwW7a9Z_MnjMtn4lcGwJsJgiiUZ66k&callback=initMap'></script>
      </body>
    </html>