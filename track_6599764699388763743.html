<!DOCTYPE html>
    <html>
      <head>
          <title>Google Maps API</title>
          <script>
              var dataPoints = [{"timestamp":"1675905575","device_id":"6599764699388763743","latitude":50.0517478,"longitude":8.5777525},{"timestamp":"1675904595","device_id":"6599764699388763743","latitude":50.0520895,"longitude":8.5776588},{"timestamp":"1675902776","device_id":"6599764699388763743","latitude":50.0519216,"longitude":8.5779477},{"timestamp":"1675902431","device_id":"6599764699388763743","latitude":50.0516625,"longitude":8.5776135},{"timestamp":"1675901856","device_id":"6599764699388763743","latitude":50.0518188,"longitude":8.5778703},{"timestamp":"1675900410","device_id":"6599764699388763743","latitude":50.0514605,"longitude":8.5768748},{"timestamp":"1675900176","device_id":"6599764699388763743","latitude":50.0516579,"longitude":8.5775934},{"timestamp":"1675898764","device_id":"6599764699388763743","latitude":50.0529548,"longitude":8.57527},{"timestamp":"1675898568","device_id":"6599764699388763743","latitude":50.0514685,"longitude":8.577258},{"timestamp":"1675898151","device_id":"6599764699388763743","latitude":50.0531622,"longitude":8.5759863},{"timestamp":"1675895905","device_id":"6599764699388763743","latitude":50.0533423,"longitude":8.5770567},{"timestamp":"1675895302","device_id":"6599764699388763743","latitude":50.0512909,"longitude":8.5798685},{"timestamp":"1675894995","device_id":"6599764699388763743","latitude":50.0834118,"longitude":8.6185398},{"timestamp":"1675894630","device_id":"6599764699388763743","latitude":50.0910965,"longitude":8.6171875},{"timestamp":"1675894209","device_id":"6599764699388763743","latitude":50.0937864,"longitude":8.6365674},{"timestamp":"1675893537","device_id":"6599764699388763743","latitude":50.0935871,"longitude":8.6362981},{"timestamp":"1675892896","device_id":"6599764699388763743","latitude":50.0940053,"longitude":8.6367143},{"timestamp":"1675892290","device_id":"6599764699388763743","latitude":50.0937511,"longitude":8.6353828},{"timestamp":"1675891893","device_id":"6599764699388763743","latitude":50.0935828,"longitude":8.636496},{"timestamp":"1675891845","device_id":"6599764699388763743","latitude":50.0938372,"longitude":8.637142},{"timestamp":"1675891683","device_id":"6599764699388763743","latitude":50.0934314,"longitude":8.635894},{"timestamp":"1675891346","device_id":"6599764699388763743","latitude":50.0935395,"longitude":8.6366881},{"timestamp":"1675891332","device_id":"6599764699388763743","latitude":50.0944124,"longitude":8.6352423},{"timestamp":"1675890925","device_id":"6599764699388763743","latitude":50.0938007,"longitude":8.6366903},{"timestamp":"1675890771","device_id":"6599764699388763743","latitude":50.0954837,"longitude":8.6335764},{"timestamp":"1675890506","device_id":"6599764699388763743","latitude":50.0938096,"longitude":8.6358778},{"timestamp":"1675890059","device_id":"6599764699388763743","latitude":50.094278,"longitude":8.6364426},{"timestamp":"1675889335","device_id":"6599764699388763743","latitude":50.0936174,"longitude":8.6365719},{"timestamp":"1675889313","device_id":"6599764699388763743","latitude":50.0936471,"longitude":8.6365759},{"timestamp":"1675888635","device_id":"6599764699388763743","latitude":50.0937016,"longitude":8.6357389},{"timestamp":"1675888190","device_id":"6599764699388763743","latitude":50.0941045,"longitude":8.6370211},{"timestamp":"1675888050","device_id":"6599764699388763743","latitude":50.0934987,"longitude":8.636557},{"timestamp":"1675888024","device_id":"6599764699388763743","latitude":50.0934991,"longitude":8.6365899},{"timestamp":"1675887982","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675887747","device_id":"6599764699388763743","latitude":50.0936254,"longitude":8.6351343},{"timestamp":"1675887661","device_id":"6599764699388763743","latitude":50.0925942,"longitude":8.6350683},{"timestamp":"1675887543","device_id":"6599764699388763743","latitude":50.0939474,"longitude":8.6361727},{"timestamp":"1675887100","device_id":"6599764699388763743","latitude":50.0941055,"longitude":8.6370209},{"timestamp":"1675886939","device_id":"6599764699388763743","latitude":50.0939477,"longitude":8.6369348},{"timestamp":"1675886474","device_id":"6599764699388763743","latitude":50.094073,"longitude":8.6368555},{"timestamp":"1675886003","device_id":"6599764699388763743","latitude":50.0939294,"longitude":8.6369206},{"timestamp":"1675885913","device_id":"6599764699388763743","latitude":50.0940493,"longitude":8.6368753},{"timestamp":"1675885728","device_id":"6599764699388763743","latitude":50.0941783,"longitude":8.6357207},{"timestamp":"1675885564","device_id":"6599764699388763743","latitude":50.0939276,"longitude":8.6369201},{"timestamp":"1675885089","device_id":"6599764699388763743","latitude":50.0946428,"longitude":8.6361121},{"timestamp":"1675884463","device_id":"6599764699388763743","latitude":50.0945035,"longitude":8.6360858},{"timestamp":"1675884337","device_id":"6599764699388763743","latitude":50.0942393,"longitude":8.63656},{"timestamp":"1675884323","device_id":"6599764699388763743","latitude":50.0941056,"longitude":8.6370211},{"timestamp":"1675883417","device_id":"6599764699388763743","latitude":50.0938424,"longitude":8.6358684},{"timestamp":"1675883409","device_id":"6599764699388763743","latitude":50.0938992,"longitude":8.6359237},{"timestamp":"1675882982","device_id":"6599764699388763743","latitude":50.094278,"longitude":8.6364426},{"timestamp":"1675882392","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675882238","device_id":"6599764699388763743","latitude":50.0936273,"longitude":8.6354692},{"timestamp":"1675882168","device_id":"6599764699388763743","latitude":50.0937264,"longitude":8.6353223},{"timestamp":"1675882090","device_id":"6599764699388763743","latitude":50.0936827,"longitude":8.6352591},{"timestamp":"1675881476","device_id":"6599764699388763743","latitude":50.0937119,"longitude":8.6354667},{"timestamp":"1675880901","device_id":"6599764699388763743","latitude":50.0938407,"longitude":8.6354658},{"timestamp":"1675880566","device_id":"6599764699388763743","latitude":50.0937511,"longitude":8.6353828},{"timestamp":"1675880432","device_id":"6599764699388763743","latitude":50.093552,"longitude":8.636392},{"timestamp":"1675880223","device_id":"6599764699388763743","latitude":50.0938962,"longitude":8.6358536},{"timestamp":"1675879818","device_id":"6599764699388763743","latitude":50.0937976,"longitude":8.6353497},{"timestamp":"1675879816","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675879736","device_id":"6599764699388763743","latitude":50.0938181,"longitude":8.635632},{"timestamp":"1675879471","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675879299","device_id":"6599764699388763743","latitude":50.0937939,"longitude":8.6353889},{"timestamp":"1675878801","device_id":"6599764699388763743","latitude":50.093838,"longitude":8.6360436},{"timestamp":"1675878631","device_id":"6599764699388763743","latitude":50.0938884,"longitude":8.6356413},{"timestamp":"1675878567","device_id":"6599764699388763743","latitude":50.0938884,"longitude":8.6356413},{"timestamp":"1675878200","device_id":"6599764699388763743","latitude":50.093808,"longitude":8.6356232},{"timestamp":"1675877899","device_id":"6599764699388763743","latitude":50.093687,"longitude":8.6353671},{"timestamp":"1675877569","device_id":"6599764699388763743","latitude":50.09405,"longitude":8.635829},{"timestamp":"1675877426","device_id":"6599764699388763743","latitude":50.0938911,"longitude":8.6358996},{"timestamp":"1675876887","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675876795","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675876774","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675876331","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675876179","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675875548","device_id":"6599764699388763743","latitude":50.0938208,"longitude":8.6358056},{"timestamp":"1675875072","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675875034","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675874577","device_id":"6599764699388763743","latitude":50.0938474,"longitude":8.6360404},{"timestamp":"1675874571","device_id":"6599764699388763743","latitude":50.0938169,"longitude":8.6355939},{"timestamp":"1675874302","device_id":"6599764699388763743","latitude":50.0938645,"longitude":8.6361138},{"timestamp":"1675873763","device_id":"6599764699388763743","latitude":50.0938873,"longitude":8.6362569},{"timestamp":"1675873639","device_id":"6599764699388763743","latitude":50.0937891,"longitude":8.6354764},{"timestamp":"1675873458","device_id":"6599764699388763743","latitude":50.0939785,"longitude":8.6365003},{"timestamp":"1675873009","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675872761","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675872246","device_id":"6599764699388763743","latitude":50.0939023,"longitude":8.6358785},{"timestamp":"1675871564","device_id":"6599764699388763743","latitude":50.0938147,"longitude":8.6362531},{"timestamp":"1675871255","device_id":"6599764699388763743","latitude":50.0938849,"longitude":8.6362767},{"timestamp":"1675870379","device_id":"6599764699388763743","latitude":50.0937511,"longitude":8.6353828},{"timestamp":"1675870351","device_id":"6599764699388763743","latitude":50.093506,"longitude":8.6366327},{"timestamp":"1675865058","device_id":"6599764699388763743","latitude":50.0941776,"longitude":8.6377162},{"timestamp":"1675862177","device_id":"6599764699388763743","latitude":50.0936616,"longitude":8.6353998}];
              function initMap() {
                  var map = new google.maps.Map(document.getElementById('map'), {
                  center: {lat: dataPoints[0]['latitude'], lng: dataPoints[0]['longitude']},
                   zoom: 18
              });
              dataPoints.forEach((data, index) => {

                var date = new Date(data['timestamp'] * 1000);
                var formattedTime = date.toLocaleString('en-US', {timeZoneName: 'short'})
                var marker;
                
                if(index === 0) {
                  console.log('first')
                  marker = new google.maps.Marker({
                      position: { lat: data['latitude'], lng: data['longitude'] },
                      map: map,
                      title: formattedTime,
                      zIndex:99999999,
                      icon: {
                          url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
                      }
                  });
                } else {
                  marker = new google.maps.Marker({
                      position: { lat: data['latitude'], lng: data['longitude'] },
                      map: map,
                      title: formattedTime,
                      icon: {
                          url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                      }
                  });
                }
                var infowindow = new google.maps.InfoWindow();

                var geocoder = new google.maps.Geocoder;
                var myLatLng = {lat: data['latitude'], lng: data['longitude']};
                
                google.maps.event.addListener(marker, 'click', function() {
                  geocoder.geocode({'location': myLatLng}, function(results, status) {
                    if (status === 'OK') {
                      if (results[0]) {
                        infowindow.setContent(results[0].formatted_address + "<br>" + marker.title);
                        infowindow.open(map, marker);
                      } else {
                        window.alert('No results found');
                      }
                    } else {
                      window.alert('Geocoder failed due to: ' + status);
                    }
                });
              })
                
                google.maps.event.addListener(map, 'click', function() {
                  infowindow.close();
                });
              })
            }
          </script>
      </head>
      <body onload='initMap()'>
          <div id='map' style='height: 1200px; width: 100%;'></div>
          <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAFjmwW7a9Z_MnjMtn4lcGwJsJgiiUZ66k&callback=initMap'></script>
      </body>
    </html>